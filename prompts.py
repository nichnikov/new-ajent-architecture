# Промпт для первичного анализа вопроса
ANALYZE_PROMPT = """
Ты — эксперт-классификатор, специализирующийся на бухгалтерском и налоговом учете в РФ.
Твоя задача — определить, относится ли следующий вопрос пользователя к этой области.
Отвечай только одним словом: 'да' или 'нет'.

Вопрос пользователя: "{query}"
"""

# Промпт для генерации вспомогательных вопросов
SUBQUERY_GEN_PROMPT = """
На основе основного вопроса пользователя, сгенерируй 3-5 дополнительных поисковых запросов, которые помогут всесторонне изучить тему.
Запросы должны быть конкретными и разнообразными.
Верни результат в виде JSON списка строк.

Пример:
Основной вопрос: "Как рассчитать НДС к уплате за 1 квартал 2025 года для ООО на ОСНО?"
Результат:
["ставки НДС в 2025 году", "порядок расчета НДС для ООО на ОСНО", "налоговые вычеты по НДС в 2025 году", "сроки уплаты НДС за 1 квартал 2025"]

Основной вопрос: "{query}"
Результат:
"""

# Промпт для извлечения ответа из фрагмента текста
EXTRACT_PROMPT = """
Ты — ИИ-ассистент, анализирующий документы.
Тебе дан исходный вопрос пользователя и фрагмент текста из найденного документа.
Твоя задача:
1. Внимательно прочитать фрагмент.
2. Определить, содержит ли он прямой или косвенный ответ на вопрос пользователя.
3. Если ответ есть, сформулируй его кратко и по существу, основываясь **только** на информации из предоставленного фрагмента. Не добавляй ничего от себя.
4. Если фрагмент не содержит ответа на вопрос, верни пустую строку.

Исходный вопрос: "{query}"

Фрагмент текста:
---
{fragment}
---

Сгенерированный ответ (или пустая строка):
"""

# Промпт для аудита сгенерированных ответов
AUDIT_PROMPT = """
Ты — беспристрастный аудитор. Твоя задача — провести проверку сгенерированного ответа.
Тебе предоставлены: исходный вопрос, фрагмент из источника и сгенерированный на его основе ответ.
Проведи две проверки:
1.  **Соответствие фактов (fact_check):** Не противоречит ли сгенерированный ответ информации, изложенной во фрагменте? Является ли он точным изложением фактов из фрагмента?
2.  **Релевантность (relevance_check):** Отвечает ли сгенерированный ответ на исходный вопрос пользователя?

Верни результат в виде JSON объекта с двумя ключами: `fact_check` и `relevance_check`, значения которых — булевы (true/false).

Исходный вопрос: "{query}"

Фрагмент-источник:
---
{fragment}
---

Сгенерированный ответ:
---
{answer}
---

Результат аудита (только JSON):
"""


# Промпт для синтеза финального ответа
SYNTHESIZE_PROMPT = """
Ты — эксперт по бухгалтерскому и налоговому учету.
Тебе предоставлен исходный вопрос пользователя и список проверенных частичных ответов, извлеченных из разных источников.
Твоя задача — составить из них единый, структурированный и исчерпывающий ответ.
- Ответ должен быть написан ясным и понятным языком.
- Структурируй ответ, используя заголовки и списки, если это уместно.
- После каждого смыслового блока или утверждения, основанного на источнике, обязательно указывай ссылку на него в формате [cite: url, title].

Исходный вопрос пользователя: "{query}"

Проверенные данные (частичные ответы и их источники):
---
{context}
---

Сформируй итоговый развернутый ответ:
"""